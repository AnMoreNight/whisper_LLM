#!/usr/bin/env python3
"""
OpenAI API Client
Handles text summarization and classification using OpenAI API.
"""

from openai import OpenAI
import openpyxl
import os
import shutil
from datetime import datetime
from pathlib import Path
from typing import Dict, List, Any, Optional
import xlrd
from xlutils.copy import copy as xl_copy
import json
import re
from dotenv import load_dotenv

load_dotenv()

class Summarizer:
    """Client for OpenAI API operations."""
    
    def __init__(self, api_key: Optional[str] = None, text: Optional[str] = None, language: Optional[str] = 'ja-JP', output_dir: Optional[str] = None):
        """Initialize OpenAI client."""
        self.api_key = api_key or os.getenv('OPENAI_API_KEY')
        if not self.api_key:
            raise ValueError("OpenAI API key is required. Set OPENAI_API_KEY environment variable or pass api_key parameter.")
        
        OpenAI.api_key = self.api_key
        self.client = OpenAI(api_key=self.api_key)
        self.text = text
        self.language = language
        self.output_dir = Path(output_dir).resolve() if output_dir else None

    def run_sheet_monitor(self) -> str:
        prompt = f"""
あなたは、障害児通所支援に関する通話・面談記録から「様式11 モニタリング報告書（モニタ／週間計画）」に必要な情報を抽出する専門アシスタントです。
以下の記録から、項目ごとに該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. モニタ::利用者氏名（児童氏名）: 利用者（児童）の氏名
2. モニタ::障害支援区分: 最新の障害支援区分
3. モニタ::相談支援事業者名: 担当となる相談支援事業者名
4. モニタ::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
5. モニタ::利用者負担上限額: 利用者負担上限額（月額など）
6. モニタ::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
7. モニタ::地域相談支援受給者証番号: 地域相談支援の受給者証番号
8. モニタ::通所受給者証番号: 通所受給者証番号
9. モニタ::計画作成日: モニタリング報告書の計画作成日
10. モニタ::モニタリング実施日: 実際にモニタリングを行った日
11. モニタ::利用者同意署名欄: 利用者（保護者等）の同意署名に関する記録
12. モニタ::総合的な援助の方針: 援助方針の概要
13. モニタ::全体の状況: 利用者・家庭の全体状況
14. モニタ::目標 - 1.0 - 支援目標: 支援目標（1つ目）
15. モニタ::目標 - 1.0 - 達成時期: 上記支援目標の達成予定時期
16. モニタ::目標 - 1.0 - サービス提供状況（事業者からの聞き取り）: 事業者から得たサービス提供状況
17. モニタ::目標 - 1.0 - 本人の感想・満足度: 利用者本人の感想・満足度
18. モニタ::目標 - 1.0 - 支援目標の達成度（ニーズの充足度）: 達成度の評価
19. モニタ::目標 - 1.0 - 今後の課題・解決方法: 今後の課題や解決策
20. モニタ::目標 - 1.0 - その他留意事項: その他留意点
21. モニタ::目標 - 2.0 - 支援目標
22. モニタ::目標 - 2.0 - 達成時期
23. モニタ::目標 - 2.0 - サービス提供状況（事業者からの聞き取り）
24. モニタ::目標 - 2.0 - 本人の感想・満足度
25. モニタ::目標 - 2.0 - 支援目標の達成度（ニーズの充足度）
26. モニタ::目標 - 2.0 - 今後の課題・解決方法
27. モニタ::目標 - 2.0 - その他留意事項
28. モニタ::目標 - 3.0 - 支援目標
29. モニタ::目標 - 3.0 - 達成時期
30. モニタ::目標 - 3.0 - サービス提供状況（事業者からの聞き取り）
31. モニタ::目標 - 3.0 - 本人の感想・満足度
32. モニタ::目標 - 3.0 - 支援目標の達成度（ニーズの充足度）
33. モニタ::目標 - 3.0 - 今後の課題・解決方法
34. モニタ::目標 - 3.0 - その他留意事項
35. モニタ::目標 - 4.0 - 支援目標
36. モニタ::目標 - 4.0 - 達成時期
37. モニタ::目標 - 4.0 - サービス提供状況（事業者からの聞き取り）
38. モニタ::目標 - 4.0 - 本人の感想・満足度
39. モニタ::目標 - 4.0 - 支援目標の達成度（ニーズの充足度）
40. モニタ::目標 - 4.0 - 今後の課題・解決方法
41. モニタ::目標 - 4.0 - その他留意事項
42. モニタ::目標 - 5.0 - 支援目標
43. モニタ::目標 - 5.0 - 達成時期
44. モニタ::目標 - 5.0 - サービス提供状況（事業者からの聞き取り）
45. モニタ::目標 - 5.0 - 本人の感想・満足度
46. モニタ::目標 - 5.0 - 支援目標の達成度（ニーズの充足度）
47. モニタ::目標 - 5.0 - 今後の課題・解決方法
48. モニタ::目標 - 5.0 - その他留意事項
49. モニタ::目標 - 6.0 - 支援目標
50. モニタ::目標 - 6.0 - 達成時期
51. モニタ::目標 - 6.0 - サービス提供状況（事業者からの聞き取り）
52. モニタ::目標 - 6.0 - 本人の感想・満足度
53. モニタ::目標 - 6.0 - 支援目標の達成度（ニーズの充足度）
54. モニタ::目標 - 6.0 - 今後の課題・解決方法
55. モニタ::目標 - 6.0 - その他留意事項
56. モニタ::計画開始年月: 計画の開始年月
57. モニタ::サービス提供によって実現する生活の全体像: サービス提供により目指す生活像
58. 週間計画::利用者氏名（児童氏名）: 利用者（児童）の氏名
59. 週間計画::障害支援区分: 最新の障害支援区分
60. 週間計画::相談支援事業者名: 担当となる相談支援事業者名
61. 週間計画::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
62. 週間計画::利用者負担上限額: 利用者負担上限額（月額など）
63. 週間計画::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
64. 週間計画::地域相談支援受給者証番号: 地域相談支援の受給者証番号
65. 週間計画::通所受給者証番号: 通所受給者証番号
66. 週間計画::計画開始年月: 計画の開始年月
67. 週間計画::サービス提供によって実現する生活の全体像: サービス提供により目指す生活像

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名（シート名を含む）をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
        """
        response = self.client.responses.create(
            model="gpt-5",
            instructions=f"You are a professional assistant specializing in care service documentation. You extract and organize information for care service forms in {self.language}.",
            input=[{
                    "role": "user",
                    "content": prompt
            }]
        )
        return response.output_text.strip()

    def run_sheet_proposedPlan(self) -> str:
        prompt = f"""
あなたは、障害児通所支援に関する通話・面談記録から「様式4 サービス等利用計画案・障害児支援利用計画案（計画案／計画案週）」に必要な情報を抽出する専門アシスタントです。
以下の記録から、項目ごとに該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 計画案::利用者氏名（児童氏名）: 利用者（児童）の氏名
2. 計画案::障害支援区分: 最新の障害支援区分
3. 計画案::相談支援事業者名: 担当となる相談支援事業者名
4. 計画案::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
5. 計画案::利用者負担上限額: 利用者負担上限額（月額など）
6. 計画案::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
7. 計画案::地域相談支援受給者証番号: 地域相談支援の受給者証番号
8. 計画案::通所受給者証番号: 通所受給者証番号
9. 計画案::計画案作成日: 計画案の作成日
10. 計画案::モニタリング期間（開始年月）: モニタリング期間の開始年月
11. 計画案::利用者同意署名欄: 利用者（保護者等）の同意署名に関する記録
12. 計画案::利用者及びその家族の生活に対する意向（希望する生活）: 利用者・家族の希望する生活像
13. 計画案::総合的な援助の方針: 援助方針の概要
14. 計画案::長期目標: 長期的な支援目標
15. 計画案::短期目標: 短期的な支援目標
16. 計画案::優先順位 - 1.0 - 解決すべき課題（本人のニーズ）: 優先順位1の課題
17. 計画案::優先順位 - 1.0 - 支援目標: 上記課題の支援目標
18. 計画案::優先順位 - 1.0 - 達成時期: 上記支援目標の達成予定時期
19. 計画案::優先順位 - 1.0 - 福祉サービス等 種類・内容・量（頻度・時間）: 提供予定のサービス内容
20. 計画案::優先順位 - 1.0 - 課題解決のための本人の役割: 本人が担う役割
21. 計画案::優先順位 - 1.0 - 福祉サービス提供者名（担当者・電話等）: サービス提供者名や連絡先
22. 計画案::優先順位 - 1.0 - 評価時期: 評価予定時期
23. 計画案::優先順位 - 1.0 - その他留意事項: その他留意点
24. 計画案::優先順位 - 2.0 - 解決すべき課題（本人のニーズ）
25. 計画案::優先順位 - 2.0 - 支援目標
26. 計画案::優先順位 - 2.0 - 達成時期
27. 計画案::優先順位 - 2.0 - 福祉サービス等 種類・内容・量（頻度・時間）
28. 計画案::優先順位 - 2.0 - 課題解決のための本人の役割
29. 計画案::優先順位 - 2.0 - 福祉サービス提供者名（担当者・電話等）
30. 計画案::優先順位 - 2.0 - 評価時期
31. 計画案::優先順位 - 2.0 - その他留意事項
32. 計画案::優先順位 - 3.0 - 解決すべき課題（本人のニーズ）
33. 計画案::優先順位 - 3.0 - 支援目標
34. 計画案::優先順位 - 3.0 - 達成時期
35. 計画案::優先順位 - 3.0 - 福祉サービス等 種類・内容・量（頻度・時間）
36. 計画案::優先順位 - 3.0 - 課題解決のための本人の役割
37. 計画案::優先順位 - 3.0 - 福祉サービス提供者名（担当者・電話等）
38. 計画案::優先順位 - 3.0 - 評価時期
39. 計画案::優先順位 - 3.0 - その他留意事項
40. 計画案::優先順位 - 4.0 - 解決すべき課題（本人のニーズ）
41. 計画案::優先順位 - 4.0 - 支援目標
42. 計画案::優先順位 - 4.0 - 達成時期
43. 計画案::優先順位 - 4.0 - 福祉サービス等 種類・内容・量（頻度・時間）
44. 計画案::優先順位 - 4.0 - 課題解決のための本人の役割
45. 計画案::優先順位 - 4.0 - 福祉サービス提供者名（担当者・電話等）
46. 計画案::優先順位 - 4.0 - 評価時期
47. 計画案::優先順位 - 4.0 - その他留意事項
48. 計画案::優先順位 - 5.0 - 解決すべき課題（本人のニーズ）
49. 計画案::優先順位 - 5.0 - 支援目標
50. 計画案::優先順位 - 5.0 - 達成時期
51. 計画案::優先順位 - 5.0 - 福祉サービス等 種類・内容・量（頻度・時間）
52. 計画案::優先順位 - 5.0 - 課題解決のための本人の役割
53. 計画案::優先順位 - 5.0 - 福祉サービス提供者名（担当者・電話等）
54. 計画案::優先順位 - 5.0 - 評価時期
55. 計画案::優先順位 - 5.0 - その他留意事項
56. 計画案::優先順位 - 6.0 - 解決すべき課題（本人のニーズ）
57. 計画案::優先順位 - 6.0 - 支援目標
58. 計画案::優先順位 - 6.0 - 達成時期
59. 計画案::優先順位 - 6.0 - 福祉サービス等 種類・内容・量（頻度・時間）
60. 計画案::優先順位 - 6.0 - 課題解決のための本人の役割
61. 計画案::優先順位 - 6.0 - 福祉サービス提供者名（担当者・電話等）
62. 計画案::優先順位 - 6.0 - 評価時期
63. 計画案::優先順位 - 6.0 - その他留意事項
64. 計画案週::利用者氏名（児童氏名）: 利用者（児童）の氏名
65. 計画案週::障害支援区分: 最新の障害支援区分
66. 計画案週::相談支援事業者名: 担当となる相談支援事業者名
67. 計画案週::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
68. 計画案週::利用者負担上限額: 利用者負担上限額（月額など）
69. 計画案週::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
70. 計画案週::地域相談支援受給者証番号: 地域相談支援の受給者証番号
71. 計画案週::通所受給者証番号: 通所受給者証番号
72. 計画案週::計画開始年月: 計画の開始年月
73. 計画案週::サービス提供によって実現する生活の全体像: サービス提供により目指す生活像

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名（シート名を含む）をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet_plan(self) -> str:
        prompt = f"""
あなたは、障害児通所支援に関する通話・面談記録から「様式8 サービス等利用計画・障害児支援利用計画（計画／週間計画）」に必要な情報を抽出する専門アシスタントです。
以下の記録から、項目ごとに該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 計画::利用者氏名（児童氏名）: 利用者（児童）の氏名
2. 計画::障害支援区分: 最新の障害支援区分
3. 計画::相談支援事業者名: 担当となる相談支援事業者名
4. 計画::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
5. 計画::利用者負担上限額: 利用者負担上限額（月額など）
6. 計画::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
7. 計画::地域相談支援受給者証番号: 地域相談支援の受給者証番号
8. 計画::通所受給者証番号: 通所受給者証番号
9. 計画::計画案作成日: 計画案の作成日
10. 計画::モニタリング期間（開始年月）: モニタリング期間の開始年月
11. 計画::利用者同意署名欄: 利用者（保護者等）の同意署名に関する記録
12. 計画::利用者及びその家族の生活に対する意向（希望する生活）: 利用者・家族の希望する生活像
13. 計画::総合的な援助の方針: 援助方針の概要
14. 計画::長期目標: 長期的な支援目標
15. 計画::短期目標: 短期的な支援目標
16. 計画::優先順位 - 1.0 - 解決すべき課題（本人のニーズ）: 優先順位1の課題
17. 計画::優先順位 - 1.0 - 支援目標: 上記課題の支援目標
18. 計画::優先順位 - 1.0 - 達成時期: 上記支援目標の達成予定時期
19. 計画::優先順位 - 1.0 - 福祉サービス等 種類・内容・量（頻度・時間）: 提供予定のサービス内容
20. 計画::優先順位 - 1.0 - 課題解決のための本人の役割: 本人が担う役割
21. 計画::優先順位 - 1.0 - 福祉サービス提供者名（担当者・電話等）: サービス提供者名や連絡先
22. 計画::優先順位 - 1.0 - 評価時期: 評価予定時期
23. 計画::優先順位 - 1.0 - その他留意事項: その他留意点
24. 計画::優先順位 - 2.0 - 解決すべき課題（本人のニーズ）
25. 計画::優先順位 - 2.0 - 支援目標
26. 計画::優先順位 - 2.0 - 達成時期
27. 計画::優先順位 - 2.0 - 福祉サービス等 種類・内容・量（頻度・時間）
28. 計画::優先順位 - 2.0 - 課題解決のための本人の役割
29. 計画::優先順位 - 2.0 - 福祉サービス提供者名（担当者・電話等）
30. 計画::優先順位 - 2.0 - 評価時期
31. 計画::優先順位 - 2.0 - その他留意事項
32. 計画::優先順位 - 3.0 - 解決すべき課題（本人のニーズ）
33. 計画::優先順位 - 3.0 - 支援目標
34. 計画::優先順位 - 3.0 - 達成時期
35. 計画::優先順位 - 3.0 - 福祉サービス等 種類・内容・量（頻度・時間）
36. 計画::優先順位 - 3.0 - 課題解決のための本人の役割
37. 計画::優先順位 - 3.0 - 福祉サービス提供者名（担当者・電話等）
38. 計画::優先順位 - 3.0 - 評価時期
39. 計画::優先順位 - 3.0 - その他留意事項
40. 計画::優先順位 - 4.0 - 解決すべき課題（本人のニーズ）
41. 計画::優先順位 - 4.0 - 支援目標
42. 計画::優先順位 - 4.0 - 達成時期
43. 計画::優先順位 - 4.0 - 福祉サービス等 種類・内容・量（頻度・時間）
44. 計画::優先順位 - 4.0 - 課題解決のための本人の役割
45. 計画::優先順位 - 4.0 - 福祉サービス提供者名（担当者・電話等）
46. 計画::優先順位 - 4.0 - 評価時期
47. 計画::優先順位 - 4.0 - その他留意事項
48. 計画::優先順位 - 5.0 - 解決すべき課題（本人のニーズ）
49. 計画::優先順位 - 5.0 - 支援目標
50. 計画::優先順位 - 5.0 - 達成時期
51. 計画::優先順位 - 5.0 - 福祉サービス等 種類・内容・量（頻度・時間）
52. 計画::優先順位 - 5.0 - 課題解決のための本人の役割
53. 計画::優先順位 - 5.0 - 福祉サービス提供者名（担当者・電話等）
54. 計画::優先順位 - 5.0 - 評価時期
55. 計画::優先順位 - 5.0 - その他留意事項
56. 計画::優先順位 - 6.0 - 解決すべき課題（本人のニーズ）
57. 計画::優先順位 - 6.0 - 支援目標
58. 計画::優先順位 - 6.0 - 達成時期
59. 計画::優先順位 - 6.0 - 福祉サービス等 種類・内容・量（頻度・時間）
60. 計画::優先順位 - 6.0 - 課題解決のための本人の役割
61. 計画::優先順位 - 6.0 - 福祉サービス提供者名（担当者・電話等）
62. 計画::優先順位 - 6.0 - 評価時期
63. 計画::優先順位 - 6.0 - その他留意事項
64. 週間計画::利用者氏名（児童氏名）: 利用者（児童）の氏名
65. 週間計画::障害支援区分: 最新の障害支援区分
66. 週間計画::相談支援事業者名: 担当となる相談支援事業者名
67. 週間計画::障害福祉サービス受給者証番号: 障害福祉サービス受給者証の番号
68. 週間計画::利用者負担上限額: 利用者負担上限額（月額など）
69. 週間計画::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
70. 週間計画::地域相談支援受給者証番号: 地域相談支援の受給者証番号
71. 週間計画::通所受給者証番号: 通所受給者証番号
72. 週間計画::計画開始年月: 計画の開始年月
73. 週間計画::サービス提供によって実現する生活の全体像: サービス提供により目指す生活像

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名（シート名を含む）をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet_assessment(self) -> str:
        prompt = f"""
あなたは、障害児通所支援に関する通話・面談記録から「様式2、3 アセスメント票（訪問票兼生活支援アセスメント票）（別紙１／別紙２）」に必要な情報を抽出する専門アシスタントです。
以下の記録から、項目ごとに該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 別紙１::作成日: アセスメント票の作成日
2. 別紙１::相談支援事業者名: 担当の相談支援事業者名
3. 別紙１::計画作成担当者: 計画作成を担当した相談支援専門員の氏名
4. 別紙１::１．概要(支援経過・現状と課題等): 支援経過・現状・課題の概要
5. 別紙１::利用者の状況 - 氏名: 利用者の氏名
6. 別紙１::利用者の状況 - 生年月日: 利用者の生年月日
7. 別紙１::利用者の状況 - 年齢: 利用者の年齢
8. 別紙１::利用者の状況 - 住所: 利用者の住所
9. 別紙１::利用者の状況 - 電話番号: 利用者の電話番号
10. 別紙１::利用者の状況 - FAX番号: 利用者のFAX番号（該当時）
11. 別紙１::利用者の状況 - 障害または疾患名: 主な障害・疾患名
12. 別紙１::利用者の状況 - 障害程度区分: 障害程度区分
13. 別紙１::利用者の状況 - 性別 - 男・女: 性別（男／女）
14. 別紙１::利用者の状況 - 家族構成　※年齢、職業、主たる介護者等を記入: 家族構成の詳細
15. 別紙１::利用者の状況 - 社会関係図 ※本人と関わりを持つ機関・人物等（役割）: 社会関係図の内容
16. 別紙１::利用者の状況 - 生活歴　※受診歴等含む: 生活歴・医療歴
17. 別紙１::利用者の状況 - 医療の状況　※受診科目、頻度、主治医、疾患名、服薬状況等: 医療状況の詳細
18. 別紙１::利用者の状況 - 本人の主訴（意向・希望）: 本人の意向・希望
19. 別紙１::利用者の状況 - 家族の主訴（意向・希望）: 家族の意向・希望
20. 別紙１::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 名称: 利用中の公的支援の名称
21. 別紙１::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 提供機関・提供者: 上記支援の提供者
22. 別紙１::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 支援内容: 上記支援の内容
23. 別紙１::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 頻度: 上記支援の提供頻度
24. 別紙１::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 備考: 上記支援に関する備考
25. 別紙１::支援の状況 - その他の支援 - 名称: その他の支援の名称
26. 別紙１::支援の状況 - その他の支援 - 提供機関・提供者: その他支援の提供者
27. 別紙１::支援の状況 - その他の支援 - 支援内容: その他支援の内容
28. 別紙１::支援の状況 - その他の支援 - 頻度: その他支援の提供頻度
29. 別紙１::支援の状況 - その他の支援 - 備考: その他支援の備考
30. 別紙２::利用者氏名: 別紙２に記載する利用者氏名
31. 別紙２::障害程度区分: 別紙２に記載する障害程度区分
32. 別紙２::相談支援事業者名: 別紙２の相談支援事業者名
33. 別紙２::計画作成担当者: 別紙２の計画作成担当者名

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名（シート名を含む）をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()
    
    def run_sheet1(self) -> str:
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から、指定事業所加算に係る基準遵守状況[標準様式]に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 相談支援専門員氏名（主任）: 主任相談支援専門員の氏名
2. 相談支援専門員氏名（研修修了）: 研修修了の相談支援専門員氏名
3. 定期会議開催の有無: 利用者情報やサービス提供時の注意点伝達等を目的とした定期会議（週1回以上）の開催有無
4. 24時間連絡体制の有無の確保: 24時間連絡体制の確保状況（有無）
5. 24時間連絡体制の確保の具体的な方法: 上記体制の具体的方法
6. 研修実施の有無: 新規採用の相談支援専門員の研修実施状況
7. 基幹相談支援センターとの連携の有無: 支援困難事例に対する基幹相談支援センター等との連携有無
8. 基幹相談支援センターとの連携開始回数: 上記連携の開始回数（数値）
9. 事例検討会への参加の有無： 基幹相談支援センター等の実施する事例検討会への参加有無
10. 事例検討会への参加　参加日： 上記事例検討会の参加日
11. 事例検討会への参加主催者： 上記事例検討会の主催者
12. サービス利用支援件数（月間平均）： 過去6か月間のサービス利用支援件数（月間平均、数値）
13. 相談支援専門員数（月間平均）過去6か月間： 過去6か月間の相談支援専門員数（月間平均、数値）

下記の通話・面談記録（Transcript）をもとに、必要事項をJSON形式で出力してください。各項目は日本語フィールド名（上記項目名）をそのままキーに利用し、値を記載してください。該当なし・不明な場合は空欄""としてください。

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet2(self) -> str:
        sheet_name = "入院時情報提供書"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「入院時情報提供書」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者氏名: 利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 提供先機関名: 情報を提供している機関・病院・施設などの名称
4. 家族構成等: 家族構成や家庭内の状況
5. 生活歴: 利用者のこれまでの生活歴（成育歴・生活の経過など）
6. 病歴・障害歴 - 年月1: 医療・障害歴（年月と内容が分かるものがあれば記入）
7. 病歴・障害歴 - 年月2: 医療・障害歴の2件目（任意）
8. 病歴・障害歴 - 年月3: 医療・障害歴の3件目（任意）
9. 病歴・障害歴 - 年月4: 医療・障害歴の4件目（任意）
10. 病歴・障害歴 - 年月5: 医療・障害歴の5件目（任意）
11. 病歴・障害歴 - 年月6: 医療・障害歴の6件目（任意）
12. 医療機関利用状況: 通院・投薬・治療など医療機関の利用状況
13. 現在の生活状況の概要: 本人と家族の現在の生活状況
14. 利用者の状況 - 生活基盤に関する領域: 経済状況や住環境など生活基盤の情報
15. 利用者の状況 - 健康・身体に関する領域: 健康管理や身体機能に関する情報
16. 利用者の状況 - 日常生活に関する領域: 日常生活動作・生活スキル等
17. 利用者の状況 - コミュニケーションスキルに関する領域: 意思表出・理解の状況
18. 利用者の状況 - 社会生活技能に関する領域: 対人関係や社会生活スキル
19. 利用者の状況 - 社会参加に関する領域: 余暇活動や社会参加状況
20. 利用者の状況 - 教育・就労に関する領域: 学習状況や就労状況
21. 利用者の状況 - 家族支援に関する領域: 家族の支援状況や支援ニーズ

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet3(self) -> str:
        sheet_name = "退院・退所加算\u3000保存様式"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「退院・退所加算　記録（保存用）〔標準様式〕」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者氏名: 利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 病院・施設等との情報交換等の記録 - 機関名（担当者）- 1: 情報交換を実施した機関名または担当者名（1件目）
4. 病院・施設等との情報交換等の記録 - 年-1: 上記1件目の実施年（西暦）
5. 病院・施設等との情報交換等の記録 - 月-1: 上記1件目の実施月（数字）
6. 病院・施設等との情報交換等の記録 - 日-1: 上記1件目の実施日（数字）
7. 病院・施設等との情報交換等の記録 - 時間-1: 上記1件目の実施時間（例: "14:00"）
8. 病院・施設等との情報交換等の記録 - 場所-1: 上記1件目の実施場所
9. 病院・施設等との情報交換等の記録 - 情報交換等の内容-1: 上記1件目の情報交換内容（必要に応じて改行可）
10. 病院・施設等との情報交換等の記録 - 機関名（担当者）- 2: 2件目の機関名または担当者名
11. 病院・施設等との情報交換等の記録 - 年-2: 2件目の実施年
12. 病院・施設等との情報交換等の記録 - 月-2: 2件目の実施月
13. 病院・施設等との情報交換等の記録 - 日-2: 2件目の実施日
14. 病院・施設等との情報交換等の記録 - 時間-2: 2件目の実施時間
15. 病院・施設等との情報交換等の記録 - 場所-2: 2件目の実施場所
16. 病院・施設等との情報交換等の記録 - 情報交換等の内容-2: 2件目の情報交換内容
17. 病院・施設等との情報交換等の記録 - 機関名（担当者）- 3: 3件目の機関名または担当者名
18. 病院・施設等との情報交換等の記録 - 年-3: 3件目の実施年
19. 病院・施設等との情報交換等の記録 - 月-3: 3件目の実施月
20. 病院・施設等との情報交換等の記録 - 日-3: 3件目の実施日
21. 病院・施設等との情報交換等の記録 - 時間-3: 3件目の実施時間
22. 病院・施設等との情報交換等の記録 - 場所-3: 3件目の実施場所
23. 病院・施設等との情報交換等の記録 - 情報交換等の内容-3: 3件目の情報交換内容
24. 情報交換の結果からサービス等利用計画に反映されるべき事項: サービス等利用計画に反映すべき事項のまとめ

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet4(self) -> str:
        sheet_name = "居宅介護支援事業所等連携加算\u3000保存様式"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「居宅介護支援事業所等連携加算　保存様式」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者氏名: 利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 1: 情報交換を実施した機関名または担当者名（1件目）
4. 居宅介護支援事業所等との連携についての記録 - 年-1: 上記1件目の実施年（西暦）
5. 居宅介護支援事業所等との連携についての記録 - 月-1: 上記1件目の実施月（数字）
6. 居宅介護支援事業所等との連携についての記録 - 日-1: 上記1件目の実施日（数字）
7. 居宅介護支援事業所等との連携についての記録 - 時間-1: 上記1件目の実施時間（例: "14:00"）
8. 居宅介護支援事業所等との連携についての記録 - 場所-1: 上記1件目の実施場所
9. 居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-1: 上記1件目の情報交換内容（必要に応じて改行可）
10. 居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 2: 2件目の機関名または担当者名
11. 居宅介護支援事業所等との連携についての記録 - 年-2: 2件目の実施年
12. 居宅介護支援事業所等との連携についての記録 - 月-2: 2件目の実施月
13. 居宅介護支援事業所等との連携についての記録 - 日-2: 2件目の実施日
14. 居宅介護支援事業所等との連携についての記録 - 時間-2: 2件目の実施時間
15. 居宅介護支援事業所等との連携についての記録 - 場所-2: 2件目の実施場所
16. 居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-2: 2件目の情報交換内容
17. 居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 3: 3件目の機関名または担当者名
18. 居宅介護支援事業所等との連携についての記録 - 年-3: 3件目の実施年
19. 居宅介護支援事業所等との連携についての記録 - 月-3: 3件目の実施月
20. 居宅介護支援事業所等との連携についての記録 - 日-3: 3件目の実施日
21. 居宅介護支援事業所等との連携についての記録 - 時間-3: 3件目の実施時間
22. 居宅介護支援事業所等との連携についての記録 - 場所-3: 3件目の実施場所
23. 居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-3: 3件目の情報交換内容
24. 情報交換の結果からサービス等利用計画に反映されるべき事項: 連携内容からサービス等利用計画に反映すべき事項
25. 居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 4: 4件目の機関名または担当者名
26. 居宅介護支援事業所等との連携についての記録 - 年-4: 4件目の実施年
27. 居宅介護支援事業所等との連携についての記録 - 月-4: 4件目の実施月
28. 居宅介護支援事業所等との連携についての記録 - 日-4: 4件目の実施日
29. 居宅介護支援事業所等との連携についての記録 - 時間-4: 4件目の実施時間
30. 居宅介護支援事業所等との連携についての記録 - 場所-4: 4件目の実施場所
31. 居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-4: 4件目の情報交換内容（テンプレート上の指定に合わせて記載）

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet5(self) -> str:
        sheet_name = "医療・保育・教育連携加算\u3000保存様式"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「医療・保育・教育連携加算 保存様式」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者氏名: 利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 機関名（担当者）: 情報交換を行った機関名または担当者名（1件目）
4. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 年: 上記1件目の実施年（西暦）
5. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 月: 上記1件目の実施月（数字）
6. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 日: 上記1件目の実施日（数字）
7. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 時間: 上記1件目の実施時間（例: "14:00"）
8. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 場所: 上記1件目の実施場所
9. 医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 情報交換等の内容: 上記1件目の情報交換内容（必要に応じて改行可）
10. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 機関名（担当者）: 2件目の機関名または担当者名
11. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 年: 2件目の実施年
12. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 月: 2件目の実施月
13. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 日: 2件目の実施日
14. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 時間: 2件目の実施時間
15. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 場所: 2件目の実施場所
16. 医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 情報交換等の内容: 2件目の情報交換内容
17. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 機関名（担当者）: 3件目の機関名または担当者名
18. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 年: 3件目の実施年
19. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 月: 3件目の実施月
20. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 日: 3件目の実施日
21. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 時間: 3件目の実施時間
22. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 場所: 3件目の実施場所
23. 医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 情報交換等の内容: 3件目の情報交換内容
24. 情報交換の結果からサービス等利用計画に反映されるべき事項: 情報交換を踏まえてサービス等利用計画に反映すべき事項

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値はすべて文字列で出力し、該当なしの場合は空文字""としてください。必要に応じて箇条書きは改行で区切って構いません。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet6(self) -> str:
        sheet_name = "サービス担当者会議記録\u3000保存様式"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「サービス担当者会議記録 保存様式」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者名: 会議対象となる利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 開催年月日 - 年: 会議開催年（西暦）
4. 開催年月日 - 月: 会議開催月
5. 開催年月日 - 日: 会議開催日
6. 開催時間 - 開始: 会議開始時間
7. 開催時間 - 終了: 会議終了時間
8. 開催場所: 会議の開催場所
9. 区分 - １ サービス利用支援: 「１ サービス利用支援」に該当する場合の記載（該当なければ空欄）
10. 区分 - ２ 継続サービス利用支援: 「２ 継続サービス利用支援」に該当する場合の記載（該当なければ空欄）
11. 会議出席者 - 1 - 所属（職種）: 1人目の出席者の所属や職種
12. 会議出席者 - 1 - 氏名: 1人目の出席者の氏名
13. 会議出席者 - 2 - 所属（職種）: 2人目の出席者の所属や職種
14. 会議出席者 - 2 - 氏名: 2人目の出席者の氏名
15. 会議出席者 - 3 - 所属（職種）: 3人目の出席者の所属や職種
16. 会議出席者 - 3 - 氏名: 3人目の出席者の氏名
17. 会議出席者 - 4 - 所属（職種）: 4人目の出席者の所属や職種
18. 会議出席者 - 4 - 氏名: 4人目の出席者の氏名
19. 会議出席者 - 5 - 所属（職種）: 5人目の出席者の所属や職種
20. 会議出席者 - 5 - 氏名: 5人目の出席者の氏名
21. 会議出席者 - 6 - 所属（職種）: 6人目の出席者の所属や職種
22. 会議出席者 - 6 - 氏名: 6人目の出席者の氏名
23. 会議出席者 - 7 - 所属（職種）: 7人目の出席者の所属や職種
24. 会議出席者 - 7 - 氏名: 7人目の出席者の氏名
25. 会議出席者 - 8 - 所属（職種）: 8人目の出席者の所属や職種
26. 会議出席者 - 8 - 氏名: 8人目の出席者の氏名
27. 検討した項目: 会議で検討した主な項目
28. 検討した内容: 検討項目ごとの詳細内容（必要に応じて改行可）
29. 検討した結果: 検討の結果や決定事項
30. その他: その他特記事項

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値は文字列で出力し、該当なしの場合は空文字""としてください。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()

    def run_sheet7(self) -> str:
        sheet_name = "サービス提供時モニタリング記録\u3000保存様式"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「サービス提供時モニタリング記録 保存様式」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. 利用者氏名: 利用者の氏名
2. 相談支援専門員氏名: 担当相談支援専門員の氏名
3. 実施年月日 - 年: モニタリング実施年（西暦）
4. 実施年月日 - 月: モニタリング実施月
5. 実施年月日 - 日: モニタリング実施日
6. 実施時間 - 開始: 実施開始時間
7. 実施時間 - 終了: 実施終了時間
8. 実施場所（自宅・事業所名など）: 実施場所の名称や区分
9. 確認事項（モニタリング前に記入）: モニタリング前に確認した事項
10. 提供されていた支援: 実施時に提供されていた支援内容
11. サービス提供時の利用者の様子: 利用者の具体的な様子や反応
12. その他（利用者・サービス提供事業者等とのやり取り等）: その他共有すべき事項（必要に応じて改行可）

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値は文字列で出力し、該当なしの場合は空文字""としてください。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()
    
    def run_sheet8(self) -> str:
        sheet_name = "体制加算\u3000記録"
        prompt = f"""
あなたは、障害児の福祉サービスに関する通話・面談記録から「体制加算 記録」に必要な情報を抽出する専門アシスタントです。
以下の記録から、該当する情報が明示されている、もしくは合理的に推測できる場合は記入し、なければ空欄にしてください。

抽出対象項目（日本語フィールド名・抽出内容）:
1. （１）行動障害支援体制加算 - 研修名: 行動障害支援体制加算に関する研修名
2. （１）行動障害支援体制加算 - 修了者名: 上記研修の修了者名
3. （２）要医療児者支援体制加算 - 研修名: 要医療児者支援体制加算に関する研修名
4. （２）要医療児者支援体制加算 - 修了者名: 上記研修の修了者名
5. （３）精神障害者支援体制加算 - 研修名: 精神障害者支援体制加算に関する研修名
6. （３）精神障害者支援体制加算 - 修了者名: 上記研修の修了者名
7. （１）行動障害支援体制加算 - 具体的な方法: 行動障害支援体制加算における具体的な支援方法
8. （２）要医療児者支援体制加算 - 具体的な方法: 要医療児者支援体制加算における具体的な支援方法
9. （３）精神障害者支援体制加算 - 具体的な方法: 精神障害者支援体制加算における具体的な支援方法

出力は必ず以下のJSON形式とし、各キーには上記の日本語フィールド名をそのまま使用してください。値は文字列で出力し、該当なしの場合は空文字""としてください。
"フィールド名": "値"

Transcript:
{self.text}
"""
        response = self.client.responses.create(
            model="gpt-5",
            input=[{"role": "user", "content": prompt}]
        )
        return response.output_text.strip()
    
    
    def canon(self,key: str) -> str:
        k = key.lower()
        k = k.replace("（","(").replace("）",")")
        k = re.sub(r"\\s+"," ",k)
        k = re.sub(r"^[\\d\\.\\)\\s]+","",k)
        return k.strip()

    def resolve_target_cell(self, ws, cell_ref):
        try:
            cell = ws[cell_ref]
            r, c = cell.row, cell.column
            for rng in ws.merged_cells.ranges:
                if rng.min_row <= r <= rng.max_row and rng.min_col <= c <= rng.max_col:
                    return ws.cell(row=rng.min_row, column=rng.min_col).coordinate
            return cell_ref
        except Exception:
            for mr in ws.merged_cells.ranges:
                if cell_ref in mr:
                    return ws.cell(row=mr.min_row, column=mr.min_col).coordinate
            return cell_ref
    def get_load_wb(self, excel_path, output_filename: Optional[str] = None):
        """Load workbook by copying the template excel_path into the session output directory."""
        template_path = Path(excel_path)
        if not template_path.exists():
            raise FileNotFoundError(f"Excel file not found: {excel_path}")

        # Ensure output directory exists
        if self.output_dir is None:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            self.output_dir = Path("./outputs") / timestamp
        self.output_dir.mkdir(parents=True, exist_ok=True)

        output_filename = output_filename or template_path.name
        destination_path = self.output_dir / output_filename

        if not destination_path.exists():
            shutil.copy2(str(template_path), str(destination_path))
        # Determine Excel format by extension
        ext = destination_path.suffix.lower()

        if ext == ".xlsx":
            workbook = openpyxl.load_workbook(destination_path)
        elif ext == ".xls":
            print("adl;sfjlka;jsf", destination_path)
            book_rd = xlrd.open_workbook(destination_path)
            print("book_rd", book_rd)
            workbook = xl_copy(book_rd)
            print("workbook", workbook)
        else:
            raise ValueError(f"Unsupported Excel format: {ext}")

        workbook = openpyxl.load_workbook(destination_path)
        return workbook, str(destination_path)

    def get_val(self, data_canon, label: str, lang="Japanese"):
        """Get value from data_canon for the given label. Handles simple string values."""
        block = data_canon.get(self.canon(label), "")
        
        # If block is a string (simple format), return it directly
        if isinstance(block, str):
            return block.strip()
        
        # If block is a dict (old format with language keys), extract the language value
        if isinstance(block, dict):
            return str(block.get(lang, "") or "").strip()
        
        # For other types, convert to string
        return str(block or "").strip()
            
    def insert_sheet1(self, data: dict) -> str:
        sheet_name = "特定事業所加算　保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
           "相談支援専門員氏名（主任）": "F21",
           "相談支援専門員氏名（研修修了）": "F26",
           "定期会議開催の有無": "K35",
           "24時間連絡体制の確保の有無": "K43",
           "24時間連絡体制の確保の具体的な方法": "E45",
           "研修実施の有無": "K50",
           "基幹相談支援センターとの連携の有無": "K56",
           "基幹相談支援センターとの連携開始件数": "K57",
           "事例検討会への参加の有無": "K60",
           "事例検討会への参加　参加日": "K61",
           "事例検討会への参加主催者": "N61",
           "月間サービス利用支援件数（過去6ヶ月平均）": "K67",
           "月間相談支援専門員数（過去6ヶ月平均）": "K68"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet2(self, data: dict) -> str:
        sheet_name = "入院時情報提供書"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者氏名": "D3",
            "相談支援専門員氏名": "R3",
            "提供先機関名": "E6",
            "家族構成等": "B9",
            "生活歴": "B14",
            "病歴・障害歴 - 年月1": "B20",            
            "病歴・障害歴 - 年月2": "M20",            
            "病歴・障害歴 - 年月3": "B22",
            "病歴・障害歴 - 年月4": "M22",
            "病歴・障害歴 - 年月5": "B24",
            "病歴・障害歴 - 年月6": "M24",
            "医療機関利用状況" : "B27",
            "現在の生活状況の概要": "B32",
            "利用者の状況 - 生活基盤に関する領域": "B41",
            "利用者の状況 - 健康・身体に関する領域": "B50",
            "利用者の状況 - 日常生活に関する領域": "B61",
            "利用者の状況 - コミュニケーションスキルに関する領域": "B74",
            "利用者の状況 - 社会生活技能に関する領域": "B85",
            "利用者の状況 - 社会参加に関する領域": "B93",
            "利用者の状況 - 教育・就労に関する領域": "B101",
            "利用者の状況 - 家族支援に関する領域": "B109"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet3(self, data: dict) -> str:
        sheet_name = "退院・退所加算\u3000保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者氏名": "D4",
            "相談支援専門員氏名": "R4",
            "病院・施設等との情報交換等の記録 - 機関名（担当者）- 1": "F8",
            "病院・施設等との情報交換等の記録 - 年-1": "E10",
            "病院・施設等との情報交換等の記録 - 月-1": "G10",
            "病院・施設等との情報交換等の記録 - 日-1": "I10",
            "病院・施設等との情報交換等の記録 - 時間-1": "M10",
            "病院・施設等との情報交換等の記録 - 場所-1": "S10",
            "病院・施設等との情報交換等の記録 - 情報交換等の内容-1": "C12",
            "病院・施設等との情報交換等の記録 - 機関名（担当者）- 2": "F22",
            "病院・施設等との情報交換等の記録 - 年-2": "E23",
            "病院・施設等との情報交換等の記録 - 月-2": "G23",
            "病院・施設等との情報交換等の記録 - 日-2": "I23",
            "病院・施設等との情報交換等の記録 - 時間-2": "M23",
            "病院・施設等との情報交換等の記録 - 場所-2": "S23",
            "病院・施設等との情報交換等の記録 - 情報交換等の内容-2": "C25",
            "病院・施設等との情報交換等の記録 - 機関名（担当者）- 3": "F34",
            "病院・施設等との情報交換等の記録 - 年-3": "E36",
            "病院・施設等との情報交換等の記録 - 月-3": "G36",
            "病院・施設等との情報交換等の記録 - 日-3": "I36",
            "病院・施設等との情報交換等の記録 - 時間-3": "M36",
            "病院・施設等との情報交換等の記録 - 場所-3": "S36",
            "病院・施設等との情報交換等の記録 - 情報交換等の内容-3": "C38",
            "情報交換の結果からサービス等利用計画に反映されるべき事項": "B49",
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet4(self, data: dict) -> str:
        sheet_name = "居宅介護支援事業所等連携加算\u3000保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者氏名": "D4",
            "相談支援専門員氏名": "R4",
            "居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 1": "F8",
            "居宅介護支援事業所等との連携についての記録 - 年-1": "E10",
            "居宅介護支援事業所等との連携についての記録 - 月-1": "G10",
            "居宅介護支援事業所等との連携についての記録 - 日-1": "I10",
            "居宅介護支援事業所等との連携についての記録 - 時間-1": "M10",
            "居宅介護支援事業所等との連携についての記録 - 場所-1": "S10",
            "居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-1": "C12",
            "居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 2": "F22",
            "居宅介護支援事業所等との連携についての記録 - 年-2": "E23",
            "居宅介護支援事業所等との連携についての記録 - 月-2": "G23",
            "居宅介護支援事業所等との連携についての記録 - 日-2": "I23",
            "居宅介護支援事業所等との連携についての記録 - 時間-2": "M23",
            "居宅介護支援事業所等との連携についての記録 - 場所-2": "S23",
            "居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-2": "C25",
            "居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 3": "F34",
            "居宅介護支援事業所等との連携についての記録 - 年-3": "E36",
            "居宅介護支援事業所等との連携についての記録 - 月-3": "G36",
            "居宅介護支援事業所等との連携についての記録 - 日-3": "I36",
            "居宅介護支援事業所等との連携についての記録 - 時間-3": "M36",
            "居宅介護支援事業所等との連携についての記録 - 場所-3": "S36",
            "居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-3": "C38",
            "情報交換の結果からサービス等利用計画に反映されるべき事項": "B49",
            "居宅介護支援事業所等との連携についての記録 - 機関名（担当者）- 4": "F48",
            "居宅介護支援事業所等との連携についての記録 - 年-4": "E50",
            "居宅介護支援事業所等との連携についての記録 - 月-4": "G50",
            "居宅介護支援事業所等との連携についての記録 - 日-4": "I50",
            "居宅介護支援事業所等との連携についての記録 - 時間-4": "M50",
            "居宅介護支援事業所等との連携についての記録 - 場所-4": "S50",
            "居宅介護支援事業所等との連携についての記録 - 情報交換等の内容-4": "C52"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet5(self, data: dict) -> str:
        sheet_name = "医療・保育・教育連携加算\u3000保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者氏名": "D4",
            "相談支援専門員氏名": "R4",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 機関名（担当者）": "F9",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 年": "E11",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 月": "G11",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 年月日 - 日": "I11",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 時間": "M11",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 場所": "S11",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 1 - 情報交換等の内容": "C13",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 機関名（担当者）": "F22",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 年": "E24",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 月": "G24",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 年月日 - 日": "I24",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 時間": "M24",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 場所": "S24",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 2 - 情報交換等の内容": "C26",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 機関名（担当者）": "F35",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 年": "E37",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 月": "G37",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 年月日 - 日": "I37",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 時間": "M37",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 場所": "S37",
            "医療機関、保育園等、教育機関等との情報交換等の記録 - 3 - 情報交換等の内容": "C39",
            "情報交換の結果からサービス等利用計画に反映されるべき事項": "A50"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet6(self, data: dict) -> str:
        sheet_name = "サービス担当者会議記録\u3000保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者名": "D3",
            "相談支援専門員氏名": "R3",
            "開催年月日 - 年": "E5",
            "開催年月日 - 月": "G5",
            "開催年月日 - 日": "I5",
            "開催時間 - 開始": "P5",
            "開催時間 - 終了": "T5",
            "開催場所": "D7",
            "区分 - １ サービス利用支援": "G10",
            "区分 - ２ 継続サービス利用支援": "L10",
            "会議出席者 - 1 - 所属（職種）": "D12",
            "会議出席者 - 1 - 氏名": "I12",
            "会議出席者 - 2 - 所属（職種）": "N12",
            "会議出席者 - 2 - 氏名": "S12",
            "会議出席者 - 3 - 所属（職種）": "D13",
            "会議出席者 - 3 - 氏名": "I13",
            "会議出席者 - 4 - 所属（職種）": "N13",
            "会議出席者 - 4 - 氏名": "S13",
            "会議出席者 - 5 - 所属（職種）": "D14",
            "会議出席者 - 5 - 氏名": "I14",
            "会議出席者 - 6 - 所属（職種）": "N14",
            "会議出席者 - 6 - 氏名": "S14",
            "会議出席者 - 7 - 所属（職種）": "D15",
            "会議出席者 - 7 - 氏名": "I15",
            "会議出席者 - 8 - 所属（職種）": "N15",
            "会議出席者 - 8 - 氏名": "S15",
            "検討した項目": "D16",
            "検討した内容": "D25",
            "検討した結果": "D39",
            "その他": "D53"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet7(self, data: dict) -> str:
        sheet_name = "サービス提供時モニタリング記録\u3000保存様式"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "利用者氏名": "D4",
            "相談支援専門員氏名": "R4",
            "実施年月日 - 年": "E6",
            "実施年月日 - 月": "G6",
            "実施年月日 - 日": "I6",
            "実施時間 - 開始": "P6",
            "実施時間 - 終了": "T6",
            "実施場所（自宅・事業所名など）": "I8",
            "確認事項（モニタリング前に記入）": "F11",
            "提供されていた支援": "F22",
            "サービス提供時の利用者の様子": "F36",
            "その他（利用者・サービス提供事業者等とのやり取り等）": "F49"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_sheet8(self, data: dict) -> str:
        sheet_name = "体制加算\u3000記録"
        excel_path = "./samples/サービス担当者会議記録（保存用）標準様式　各種加算標準様式（Excel形式：92KB）.xlsx"

        cell_mapping = {
            "（１）行動障害支援体制加算 - 研修名": "F18",
            "（１）行動障害支援体制加算 - 修了者名": "F20",
            "（２）要医療児者支援体制加算 - 研修名": "F26",
            "（２）要医療児者支援体制加算 - 修了者名": "F28",
            "（３）精神障害者支援体制加算 - 研修名": "F34",
            "（３）精神障害者支援体制加算 - 修了者名": "F36",
            "（１）行動障害支援体制加算 - 具体的な方法": "E47",
            "（２）要医療児者支援体制加算 - 具体的な方法": "E55",
            "（３）精神障害者支援体制加算 - 具体的な方法": "E63"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws = wb[sheet_name] if sheet_name in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws, cell_ref)
            ws[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_monitor_sheet(self, data : dict) -> str:
        # print("monitor :", data)
        sheet_name1 = "モニタ"
        sheet_name2 = "週間計画"
        excel_path = "./samples/様式11　モニタリング報告書（Excel形式：45KB）.xlsx"

        cell_mapping1 = {
            f"{sheet_name1}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name1}::障害支援区分": "AD4",
            f"{sheet_name1}::相談支援事業者名": "AY4",
            f"{sheet_name1}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name1}::利用者負担上限額": "AD6",
            f"{sheet_name1}::計画作成担当者": "AY6",
            f"{sheet_name1}::地域相談支援受給者証番号": "I7",
            f"{sheet_name1}::通所受給者証番号": "AD7",
            f"{sheet_name1}::計画作成日": "I9",
            f"{sheet_name1}::モニタリング実施日": "AD9",
            f"{sheet_name1}::利用者同意署名欄": "AY9",
            f"{sheet_name1}::総合的な援助の方針": "A12",
            f"{sheet_name1}::全体の状況": "AF12",
            f"{sheet_name1}::目標 - 1.0 - 支援目標": "B16",
            f"{sheet_name1}::目標 - 1.0 - 達成時期": "I16",
            f"{sheet_name1}::目標 - 1.0 - サービス提供状況（事業者からの聞き取り）": "L16",
            f"{sheet_name1}::目標 - 1.0 - 本人の感想・満足度": "T16",
            f"{sheet_name1}::目標 - 1.0 - 支援目標の達成度（ニーズの充足度）": "AB16",
            f"{sheet_name1}::目標 - 1.0 - 今後の課題・解決方法": "BD16",
            f"{sheet_name1}::目標 - 1.0 - その他留意事項": "AP16",
            f"{sheet_name1}::目標 - 2.0 - 支援目標": "B17",
            f"{sheet_name1}::目標 - 2.0 - 達成時期": "I17",
            f"{sheet_name1}::目標 - 2.0 - サービス提供状況（事業者からの聞き取り）": "L17",
            f"{sheet_name1}::目標 - 2.0 - 本人の感想・満足度": "T17",
            f"{sheet_name1}::目標 - 2.0 - 支援目標の達成度（ニーズの充足度）": "AB17",
            f"{sheet_name1}::目標 - 2.0 - 今後の課題・解決方法": "BD17",
            f"{sheet_name1}::目標 - 2.0 - その他留意事項": "AP17",
            f"{sheet_name1}::目標 - 3.0 - 支援目標": "B18",
            f"{sheet_name1}::目標 - 3.0 - 達成時期": "I18",
            f"{sheet_name1}::目標 - 3.0 - サービス提供状況（事業者からの聞き取り）": "L18",
            f"{sheet_name1}::目標 - 3.0 - 本人の感想・満足度": "T18",
            f"{sheet_name1}::目標 - 3.0 - 支援目標の達成度（ニーズの充足度）": "AB18",
            f"{sheet_name1}::目標 - 3.0 - 今後の課題・解決方法": "BD18",
            f"{sheet_name1}::目標 - 3.0 - その他留意事項": "AP18",
            f"{sheet_name1}::目標 - 4.0 - 支援目標": "B19",
            f"{sheet_name1}::目標 - 4.0 - 達成時期": "I19",
            f"{sheet_name1}::目標 - 4.0 - サービス提供状況（事業者からの聞き取り）": "L19",
            f"{sheet_name1}::目標 - 4.0 - 本人の感想・満足度": "T19",
            f"{sheet_name1}::目標 - 4.0 - 支援目標の達成度（ニーズの充足度）": "AB19",
            f"{sheet_name1}::目標 - 4.0 - 今後の課題・解決方法": "BD19",
            f"{sheet_name1}::目標 - 4.0 - その他留意事項": "AP19",
            f"{sheet_name1}::目標 - 5.0 - 支援目標": "B20",
            f"{sheet_name1}::目標 - 5.0 - 達成時期": "I20",
            f"{sheet_name1}::目標 - 5.0 - サービス提供状況（事業者からの聞き取り）": "L20",
            f"{sheet_name1}::目標 - 5.0 - 本人の感想・満足度": "T20",
            f"{sheet_name1}::目標 - 5.0 - 支援目標の達成度（ニーズの充足度）": "AB20",
            f"{sheet_name1}::目標 - 5.0 - 今後の課題・解決方法": "BD20",
            f"{sheet_name1}::目標 - 5.0 - その他留意事項": "AP20",
            f"{sheet_name1}::目標 - 6.0 - 支援目標": "B21",
            f"{sheet_name1}::目標 - 6.0 - 達成時期": "I21",
            f"{sheet_name1}::目標 - 6.0 - サービス提供状況（事業者からの聞き取り）": "L21",
            f"{sheet_name1}::目標 - 6.0 - 本人の感想・満足度": "T21",
            f"{sheet_name1}::目標 - 6.0 - 支援目標の達成度（ニーズの充足度）": "AB21",
            f"{sheet_name1}::目標 - 6.0 - 今後の課題・解決方法": "BD21",
            f"{sheet_name1}::目標 - 6.0 - その他留意事項": "AP21"
        }
        cell_mapping2 = {
            f"{sheet_name2}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name2}::障害支援区分": "AD4",
            f"{sheet_name2}::相談支援事業者名": "AY4",
            f"{sheet_name2}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name2}::利用者負担上限額": "AD6",
            f"{sheet_name2}::計画作成担当者": "AY6",
            f"{sheet_name2}::地域相談支援受給者証番号": "I7",
            f"{sheet_name2}::通所受給者証番号": "AD7",
            f"{sheet_name2}::計画開始年月": "I9",
            f"{sheet_name2}::サービス提供によって実現する生活の全体像": "E62"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws1 = wb[sheet_name1] if sheet_name1 in wb.sheetnames else wb.active
        ws2 = wb[sheet_name2] if sheet_name2 in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping1.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws1, cell_ref)
            ws1[actual_cell] = value
            
        for label, cell_ref in cell_mapping2.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws2, cell_ref)
            ws2[actual_cell] = value
        wb.save(saved_path)
        return saved_path

    def insert_proposedPlan_sheet(self, data : dict) -> str:
        sheet_name1 = "計画案"
        sheet_name2 = "計画案週"
        excel_path = "./samples/様式4　サービス等利用計画案・障害児支援利用計画案（Excel形式：45KB）.xlsx"

        cell_mapping1 = {
            f"{sheet_name1}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name1}::障害支援区分": "AD4",
            f"{sheet_name1}::相談支援事業者名": "AY4",
            f"{sheet_name1}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name1}::利用者負担上限額": "AD6",
            f"{sheet_name1}::計画作成担当者": "AY6",
            f"{sheet_name1}::地域相談支援受給者証番号": "I7",
            f"{sheet_name1}::通所受給者証番号": "AD7",
            f"{sheet_name1}::計画案作成日": "I9",
            f"{sheet_name1}::モニタリング期間（開始年月）": "AD9",
            f"{sheet_name1}::利用者同意署名欄": "AY9",
            f"{sheet_name1}::利用者及びその家族の生活に対する意向（希望する生活）": "I11",
            f"{sheet_name1}::総合的な援助の方針": "I12",
            f"{sheet_name1}::長期目標": "I13",
            f"{sheet_name1}::短期目標": "I14",
            f"{sheet_name1}::優先順位 - 1.0 - 解決すべき課題（本人のニーズ）": "B18",
            f"{sheet_name1}::優先順位 - 1.0 - 支援目標": "K18",
            f"{sheet_name1}::優先順位 - 1.0 - 達成時期": "T18",
            f"{sheet_name1}::優先順位 - 1.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X18",
            f"{sheet_name1}::優先順位 - 1.0 - 課題解決のための本人の役割": "AC18",
            f"{sheet_name1}::優先順位 - 1.0 - 福祉サービス提供者名（担当者・電話等）": "AM18",
            f"{sheet_name1}::優先順位 - 1.0 - 評価時期": "AV18",
            f"{sheet_name1}::優先順位 - 1.0 - その他留意事項": "AZ18",

            f"{sheet_name1}::優先順位 - 2.0 - 解決すべき課題（本人のニーズ）": "B19",
            f"{sheet_name1}::優先順位 - 2.0 - 支援目標": "K19",
            f"{sheet_name1}::優先順位 - 2.0 - 達成時期": "T19",
            f"{sheet_name1}::優先順位 - 2.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X19",
            f"{sheet_name1}::優先順位 - 2.0 - 課題解決のための本人の役割": "AC19",
            f"{sheet_name1}::優先順位 - 2.0 - 福祉サービス提供者名（担当者・電話等）": "AM19",
            f"{sheet_name1}::優先順位 - 2.0 - 評価時期": "AV19",
            f"{sheet_name1}::優先順位 - 2.0 - その他留意事項": "AZ19",

            f"{sheet_name1}::優先順位 - 3.0 - 解決すべき課題（本人のニーズ）": "B20",
            f"{sheet_name1}::優先順位 - 3.0 - 支援目標": "K20",
            f"{sheet_name1}::優先順位 - 3.0 - 達成時期": "T20",
            f"{sheet_name1}::優先順位 - 3.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X20",
            f"{sheet_name1}::優先順位 - 3.0 - 課題解決のための本人の役割": "AC20",
            f"{sheet_name1}::優先順位 - 3.0 - 福祉サービス提供者名（担当者・電話等）": "AM20",
            f"{sheet_name1}::優先順位 - 3.0 - 評価時期": "AV20",
            f"{sheet_name1}::優先順位 - 3.0 - その他留意事項": "AZ20",

            f"{sheet_name1}::優先順位 - 4.0 - 解決すべき課題（本人のニーズ）": "B21",
            f"{sheet_name1}::優先順位 - 4.0 - 支援目標": "K21",
            f"{sheet_name1}::優先順位 - 4.0 - 達成時期": "T21",
            f"{sheet_name1}::優先順位 - 4.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X21",
            f"{sheet_name1}::優先順位 - 4.0 - 課題解決のための本人の役割": "AC21",
            f"{sheet_name1}::優先順位 - 4.0 - 福祉サービス提供者名（担当者・電話等）": "AM21",
            f"{sheet_name1}::優先順位 - 4.0 - 評価時期": "AV21",
            f"{sheet_name1}::優先順位 - 4.0 - その他留意事項": "AZ21",

            f"{sheet_name1}::優先順位 - 5.0 - 解決すべき課題（本人のニーズ）": "B22",
            f"{sheet_name1}::優先順位 - 5.0 - 支援目標": "K22",
            f"{sheet_name1}::優先順位 - 5.0 - 達成時期": "T22",
            f"{sheet_name1}::優先順位 - 5.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X22",
            f"{sheet_name1}::優先順位 - 5.0 - 課題解決のための本人の役割": "AC22",
            f"{sheet_name1}::優先順位 - 5.0 - 福祉サービス提供者名（担当者・電話等）": "AM22",
            f"{sheet_name1}::優先順位 - 5.0 - 評価時期": "AV22",
            f"{sheet_name1}::優先順位 - 5.0 - その他留意事項": "AZ22",

            f"{sheet_name1}::優先順位 - 6.0 - 解決すべき課題（本人のニーズ）": "B23",
            f"{sheet_name1}::優先順位 - 6.0 - 支援目標": "K23",
            f"{sheet_name1}::優先順位 - 6.0 - 達成時期": "T23",
            f"{sheet_name1}::優先順位 - 6.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X23",
            f"{sheet_name1}::優先順位 - 6.0 - 課題解決のための本人の役割": "AC23",
            f"{sheet_name1}::優先順位 - 6.0 - 福祉サービス提供者名（担当者・電話等）": "AM23",
            f"{sheet_name1}::優先順位 - 6.0 - 評価時期": "AV23",
            f"{sheet_name1}::優先順位 - 6.0 - その他留意事項": "AZ23",
        }

        cell_mapping2 = {
            f"{sheet_name2}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name2}::障害支援区分": "AD4",
            f"{sheet_name2}::相談支援事業者名": "AY4",
            f"{sheet_name2}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name2}::利用者負担上限額": "AD6",
            f"{sheet_name2}::計画作成担当者": "AY6",
            f"{sheet_name2}::地域相談支援受給者証番号": "I7",
            f"{sheet_name2}::通所受給者証番号": "AD7",
            f"{sheet_name2}::計画開始年月": "I9",
            f"{sheet_name2}::サービス提供によって実現する生活の全体像": "E62"
        }
        wb, saved_path = self.get_load_wb(excel_path)
        ws1 = wb[sheet_name1] if sheet_name1 in wb.sheetnames else wb.active
        ws2 = wb[sheet_name2] if sheet_name2 in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping1.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws1, cell_ref)
            ws1[actual_cell] = value

        for label, cell_ref in cell_mapping2.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws2, cell_ref)
            ws2[actual_cell] = value

        wb.save(saved_path)
        return saved_path

    def insert_Plan_sheet(self, data: dict) -> str:
        sheet_name1 = "計画"
        sheet_name2 = "週間計画"
        excel_path = "./samples/様式8　サービス等利用計画・障害児支援利用計画（Excel形式：46KB）.xlsx"

        cell_mapping1 = {
            f"{sheet_name1}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name1}::障害支援区分": "AD4",
            f"{sheet_name1}::相談支援事業者名": "AY4",
            f"{sheet_name1}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name1}::利用者負担上限額": "AD6",
            f"{sheet_name1}::計画作成担当者": "AY6",
            f"{sheet_name1}::地域相談支援受給者証番号": "I7",
            f"{sheet_name1}::通所受給者証番号": "AD7",
            f"{sheet_name1}::計画案作成日": "I9",
            f"{sheet_name1}::モニタリング期間（開始年月）": "AD9",
            f"{sheet_name1}::利用者同意署名欄": "AY9",
            f"{sheet_name1}::利用者及びその家族の生活に対する意向（希望する生活）": "I11",
            f"{sheet_name1}::総合的な援助の方針": "I12",
            f"{sheet_name1}::長期目標": "I13",
            f"{sheet_name1}::短期目標": "I14",
            f"{sheet_name1}::優先順位 - 1.0 - 解決すべき課題（本人のニーズ）": "B18",
            f"{sheet_name1}::優先順位 - 1.0 - 支援目標": "K18",
            f"{sheet_name1}::優先順位 - 1.0 - 達成時期": "T18",
            f"{sheet_name1}::優先順位 - 1.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X18",
            f"{sheet_name1}::優先順位 - 1.0 - 課題解決のための本人の役割": "AC18",
            f"{sheet_name1}::優先順位 - 1.0 - 福祉サービス提供者名（担当者・電話等）": "AM18",
            f"{sheet_name1}::優先順位 - 1.0 - 評価時期": "AV18",
            f"{sheet_name1}::優先順位 - 1.0 - その他留意事項": "AZ18",

            f"{sheet_name1}::優先順位 - 2.0 - 解決すべき課題（本人のニーズ）": "B19",
            f"{sheet_name1}::優先順位 - 2.0 - 支援目標": "K19",
            f"{sheet_name1}::優先順位 - 2.0 - 達成時期": "T19",
            f"{sheet_name1}::優先順位 - 2.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X19",
            f"{sheet_name1}::優先順位 - 2.0 - 課題解決のための本人の役割": "AC19",
            f"{sheet_name1}::優先順位 - 2.0 - 福祉サービス提供者名（担当者・電話等）": "AM19",
            f"{sheet_name1}::優先順位 - 2.0 - 評価時期": "AV19",
            f"{sheet_name1}::優先順位 - 2.0 - その他留意事項": "AZ19",

            f"{sheet_name1}::優先順位 - 3.0 - 解決すべき課題（本人のニーズ）": "B20",
            f"{sheet_name1}::優先順位 - 3.0 - 支援目標": "K20",
            f"{sheet_name1}::優先順位 - 3.0 - 達成時期": "T20",
            f"{sheet_name1}::優先順位 - 3.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X20",
            f"{sheet_name1}::優先順位 - 3.0 - 課題解決のための本人の役割": "AC20",
            f"{sheet_name1}::優先順位 - 3.0 - 福祉サービス提供者名（担当者・電話等）": "AM20",
            f"{sheet_name1}::優先順位 - 3.0 - 評価時期": "AV20",
            f"{sheet_name1}::優先順位 - 3.0 - その他留意事項": "AZ20",

            f"{sheet_name1}::優先順位 - 4.0 - 解決すべき課題（本人のニーズ）": "B21",
            f"{sheet_name1}::優先順位 - 4.0 - 支援目標": "K21",
            f"{sheet_name1}::優先順位 - 4.0 - 達成時期": "T21",
            f"{sheet_name1}::優先順位 - 4.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X21",
            f"{sheet_name1}::優先順位 - 4.0 - 課題解決のための本人の役割": "AC21",
            f"{sheet_name1}::優先順位 - 4.0 - 福祉サービス提供者名（担当者・電話等）": "AM21",
            f"{sheet_name1}::優先順位 - 4.0 - 評価時期": "AV21",
            f"{sheet_name1}::優先順位 - 4.0 - その他留意事項": "AZ21",

            f"{sheet_name1}::優先順位 - 5.0 - 解決すべき課題（本人のニーズ）": "B22",
            f"{sheet_name1}::優先順位 - 5.0 - 支援目標": "K22",
            f"{sheet_name1}::優先順位 - 5.0 - 達成時期": "T22",
            f"{sheet_name1}::優先順位 - 5.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X22",
            f"{sheet_name1}::優先順位 - 5.0 - 課題解決のための本人の役割": "AC22",
            f"{sheet_name1}::優先順位 - 5.0 - 福祉サービス提供者名（担当者・電話等）": "AM22",
            f"{sheet_name1}::優先順位 - 5.0 - 評価時期": "AV22",
            f"{sheet_name1}::優先順位 - 5.0 - その他留意事項": "AZ22",

            f"{sheet_name1}::優先順位 - 6.0 - 解決すべき課題（本人のニーズ）": "B23",
            f"{sheet_name1}::優先順位 - 6.0 - 支援目標": "K23",
            f"{sheet_name1}::優先順位 - 6.0 - 達成時期": "T23",
            f"{sheet_name1}::優先順位 - 6.0 - 福祉サービス等 種類・内容・量（頻度・時間）": "X23",
            f"{sheet_name1}::優先順位 - 6.0 - 課題解決のための本人の役割": "AC23",
            f"{sheet_name1}::優先順位 - 6.0 - 福祉サービス提供者名（担当者・電話等）": "AM23",
            f"{sheet_name1}::優先順位 - 6.0 - 評価時期": "AV23",
            f"{sheet_name1}::優先順位 - 6.0 - その他留意事項": "AZ23",
        }

        cell_mapping2 = {
            f"{sheet_name2}::利用者氏名（児童氏名）": "I4",
            f"{sheet_name2}::障害支援区分": "AD4",
            f"{sheet_name2}::相談支援事業者名": "AY4",
            f"{sheet_name2}::障害福祉サービス受給者証番号": "I6",
            f"{sheet_name2}::利用者負担上限額": "AD6",
            f"{sheet_name2}::計画作成担当者": "AY6",
            f"{sheet_name2}::地域相談支援受給者証番号": "I7",
            f"{sheet_name2}::通所受給者証番号": "AD7",
            f"{sheet_name2}::計画開始年月": "I9",
            f"{sheet_name2}::サービス提供によって実現する生活の全体像": "E62"
        }
        wb, saved_path = self.get_load_wb(excel_path)
        ws1 = wb[sheet_name1] if sheet_name1 in wb.sheetnames else wb.active
        ws2 = wb[sheet_name2] if sheet_name2 in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping1.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws1, cell_ref)
            ws1[actual_cell] = value
        for label, cell_ref in cell_mapping2.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws2, cell_ref)
            ws2[actual_cell] = value
        wb.save(saved_path)
        return saved_path

    def insert_assessment_sheet(self, data: dict) -> str:
        sheet_name1 = "別紙１"
        sheet_name2 = "別紙２"
        excel_path = "./samples/様式2、3　アセスメント票（訪問票兼生活支援アセスメント票）（Excel形式：44KB）.xlsx"

        cell_mapping1 = {
            f"{sheet_name1}::作成日": "I4",
            f"{sheet_name1}::相談支援事業者名": "AD4",
            f"{sheet_name1}::計画作成担当者": "AY4",
            f"{sheet_name1}::１．概要(支援経過・現状と課題等)": "A6",
            f"{sheet_name1}::利用者の状況 - 氏名": "I8",
            f"{sheet_name1}::利用者の状況 - 生年月日": "R8",
            f"{sheet_name1}::利用者の状況 - 年齢": "Y8",
            f"{sheet_name1}::利用者の状況 - 住所": "I10",
            f"{sheet_name1}::利用者の状況 - 電話番号": "AY10",
            f"{sheet_name1}::利用者の状況 - FAX番号": "AY11",
            f"{sheet_name1}::利用者の状況 - 障害または疾患名": "I12",
            f"{sheet_name1}::利用者の状況 - 障害程度区分": "AD12",
            f"{sheet_name1}::利用者の状況 - 性別 - 男・女": "AY12",
            f"{sheet_name1}::利用者の状況 - 家族構成　※年齢、職業、主たる介護者等を記入": "A14",
            f"{sheet_name1}::利用者の状況 - 社会関係図 ※本人と関わりを持つ機関・人物等（役割）": "AG14",
            f"{sheet_name1}::利用者の状況 - 生活歴　※受診歴等含む": "A16",
            f"{sheet_name1}::利用者の状況 - 医療の状況　※受診科目、頻度、主治医、疾患名、服薬状況等": "AQ15",
            f"{sheet_name1}::利用者の状況 - 本人の主訴（意向・希望）": "A18",
            f"{sheet_name1}::利用者の状況 - 家族の主訴（意向・希望）": "AG18",
            f"{sheet_name1}::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 名称": "E21",
            f"{sheet_name1}::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 提供機関・提供者": "S21",
            f"{sheet_name1}::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 支援内容": "AG21",
            f"{sheet_name1}::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 頻度": "AU21",
            f"{sheet_name1}::支援の状況 - 公的支援（障害福祉サービス、介護保険等）- 備考": "BB19",
            f"{sheet_name1}::支援の状況 - その他の支援 - 名称": "E22",
            f"{sheet_name1}::支援の状況 - その他の支援 - 提供機関・提供者": "S22",
            f"{sheet_name1}::支援の状況 - その他の支援 - 支援内容": "AG22",
            f"{sheet_name1}::支援の状況 - その他の支援 - 頻度": "AU22",
            f"{sheet_name1}::支援の状況 - その他の支援 - 備考": "BB22"
        }

        cell_mapping2 = {
            f"{sheet_name2}::利用者氏名": "I4",
            f"{sheet_name2}::障害程度区分": "AD4",
            f"{sheet_name2}::相談支援事業者名": "AY4",
            f"{sheet_name2}::計画作成担当者": "AY5"
        }

        wb, saved_path = self.get_load_wb(excel_path)
        ws1 = wb[sheet_name1] if sheet_name1 in wb.sheetnames else wb.active
        ws2 = wb[sheet_name2] if sheet_name2 in wb.sheetnames else wb.active

        for label, cell_ref in cell_mapping1.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws1, cell_ref)
            ws1[actual_cell] = value
        for label, cell_ref in cell_mapping2.items():
            value = data.get(label, "")
            actual_cell = self.resolve_target_cell(ws2, cell_ref)
            ws2[actual_cell] = value
        wb.save(saved_path)
        return saved_path